<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini 번역기</title>
    <style>
        button.mic-button { padding: 10px; font-size: 16px; cursor: pointer; border: none; background-color: #28a745; color: white; border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; margin-left: 10px; }
        .controls { display: flex; align-items: center; justify-content: center; }
    </style>
</head>
<body>
    <h1>Gemini 번역기</h1>
    <textarea id="inputText" placeholder="번역할 텍스트를 입력하세요."></textarea>
    <div class="controls">
        <button onclick="startVoiceRecognition()">🎤</button>
        <button onclick="translateText()">번역하기</button>
    </div>
    <div id="result">번역 결과</div>

    <script type="module">
// **주의: 실제 서비스에서는 API 키를 클라이언트 측 코드에 직접 노출시키지 마세요.**
import { GoogleGenerativeAI } from "https://esm.run/@google/generative-ai";

const API_KEY = "AIzaSyBuxqNb7hMANG1Uj6LPBI2VO_-nhmpmhNo"; // 여기에 본인의 Gemini API 키를 넣어주세요.
const genAI = new GoogleGenerativeAI(API_KEY);

// Web Speech API 관련 기존 코드는 그대로 사용
const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
if (!SpeechRecognition) {
    alert("죄송합니다. 이 브라우저는 음성 인식 기능을 지원하지 않습니다.");
}
const recognition = new SpeechRecognition();
recognition.interimResults = false;
recognition.lang = 'ko-KR';

function startVoiceRecognition() {
    recognition.start();
    document.getElementById('inputText').value = "음성 입력 중...";
}

recognition.addEventListener('result', (event) => {
    const transcript = event.results[0][0].transcript;
    document.getElementById('inputText').value = transcript;
    translateText();
});

recognition.addEventListener('error', (event) => {
    console.error('음성 인식 오류:', event.error);
    document.getElementById('inputText').value = "음성 인식에 실패했습니다.";
});

// Gemini API 호출 부분을 GoogleGenerativeAI 라이브러리로 변경
async function translateText() {
    const inputText = document.getElementById('inputText').value;
    const resultDiv = document.getElementById('result');

    if (!inputText || inputText === "음성 입력 중..." || inputText === "음성 인식에 실패했습니다.") {
        resultDiv.textContent = "번역할 텍스트를 입력하거나 말해주세요.";
        return;
    }

    resultDiv.textContent = "번역 중...";

    try {
        // 사용할 모델을 지정합니다.
        const model = genAI.getGenerativeModel({ model: "gemini-pro" });

        // API에 보낼 프롬프트를 정의합니다.
        const prompt = `Translate the following text into Korean: "${inputText}"`;
        
        // 프롬프트를 모델에 전달하고 응답을 받습니다.
        const result = await model.generateContent(prompt);
        const response = await result.response;
        const translatedText = response.text();

        resultDiv.textContent = translatedText;

    } catch (error) {
        console.error("번역 중 오류 발생:", error);
        resultDiv.textContent = "번역에 실패했습니다. 다시 시도해주세요.";
    }
}
    </script>
</body>
</html>
